# Rime 嘸蝦米輸入法方案設定檔
# encoding: utf-8
# 錯誤日誌位置：%TEMP%\rime.weasel

# ========================================
# 方案基本資訊
# ========================================
schema:
  schema_id: liur                # 方案 ID，用於識別此輸入法
  name: 蝦米輸入法                # 顯示名稱
  version: "20181227"            # 版本號
  author:
    - 制作人
  description: |                 # 方案描述
    蝦米-拼音-注音反查輸入法
  dependencies:                  # 相依方案（空白表示無相依）

# ========================================
# 功能開關設定
# ========================================
# reset: 0 表示預設為關閉，1 表示預設為開啟
switches:
  - name: ascii_mode             # 中英文切換
    reset: 0                     # 預設為中文模式
    # states: [ 中文, 英文 ]
  - name: full_shape             # 全半形切換
    # states: [ 半形, 全形 ]
  - name: liu_w2c                # 字碼反查功能
    reset: 0                     # 預設關閉
    states: [ 正常 ,反查 ]
  - name: extended_charset       # 擴充字集
    states: [ 常用, 擴充字集 ]
    reset: 0                     # 預設使用常用字集
  - name: simplification         # 簡繁轉換
    states: [ 繁體, 简体 ]
  - name: zh_tw                  # 臺灣用語轉換
    reset: 1                     # 預設開啟

# ========================================
# 引擎設定
# ========================================
# 定義輸入法的處理流程與各個功能模組
engine:
  # ----------------------------------------
  # 處理器（Processors）
  # ----------------------------------------
  # 按照順序處理按鍵事件
  processors:
    - ascii_composer           # 處理英文模式
    - recognizer               # 辨識輸入模式（反查、拼音等）
    - key_binder               # 按鍵綁定
    - speller                  # 拼寫處理器
#    - punctuator              # 標點符號處理（已停用）
    - selector                 # 候選項選擇
    - navigator                # 候選項導航
    - express_editor           # 快速編輯
#    - fluency_editor          # 語句流編輯（已停用）

  # ----------------------------------------
  # 分段器（Segmentors）
  # ----------------------------------------
  # 將輸入切分為不同的處理段落
  segmentors:
    - ascii_segmentor          # 英文片段
    - matcher                  # 匹配器
    - abc_segmentor            # 標準字母片段
    - affix_segmentor@mkst     # 造詞模式片段（引導鍵: ;）
    - affix_segmentor@liurqry  # 讀音反查片段（引導鍵: ;;）
    - affix_segmentor@pinyin   # 拼音輸入片段（引導鍵: `）
    - affix_segmentor@phonetic # 注音輸入片段（引導鍵: ';）
#    - punct_segmentor         # 標點片段（已停用）
    - fallback_segmentor       # 備用片段處理器

  # ----------------------------------------
  # 翻譯器（Translators）
  # ----------------------------------------
  # 將輸入碼轉換為候選字詞
  translators:
#    - echo_translator         # 回顯翻譯器（已停用）
#    - punct_translator        # 標點翻譯器（已停用）
#    - script_translator       # 腳本翻譯器（已停用）
    - table_translator@mkst    # 造詞翻譯器
    - table_translator@fixed   # 固定詞庫翻譯器（支援使用者詞典）
    - table_translator@liurqry # 讀音反查翻譯器
    - table_translator         # 主翻譯器（嘸蝦米字表）
    - script_translator@pinyin # 拼音翻譯器
    - script_translator@phonetic # 注音翻譯器

  # ----------------------------------------
  # 過濾器（Filters）
  # ----------------------------------------
  # 對候選字詞進行過濾與處理
  filters:
    - simplifier                                # 簡繁轉換
    - simplifier@liu_w2c                        # 字碼反查（顯示嘸蝦米拆碼）
    - simplifier@zh_tw                          # 臺灣用語轉換
    - uniquifier                                # 過濾重複候選字（來自繁簡轉換）
    - reverse_lookup_filter@phonetic_reverse_lookup  # 注音反查過濾器
    # - single_char_filter                      # 單字優先（已停用）

# abc_segmentor:
  # extra_tags:
    # - liurqry

# ========================================
# 字碼反查設定
# ========================================
# 使用 OpenCC 顯示字的嘸蝦米拆碼
liu_w2c:
  opencc_config: liu_w2c.json        # OpenCC 設定檔
  option_name: liu_w2c               # 對應的開關名稱
  show_in_comment: true              # 在候選字註解中顯示
  tags: [ pinyin, mkst, phonetic ]   # 套用於拼音、造詞、注音模式
  tips: all                          # 顯示所有提示

# ========================================
# 臺灣用語轉換設定
# ========================================
# 只針對拼音及注音反查進行臺灣用語轉換
zh_tw:
  opencc_config: t2tw.json           # 使用繁體轉臺灣正體的 OpenCC 設定
  option_name: zh_tw                 # 對應的開關名稱
  tags: [ pinyin, phonetic ]         # 只套用於拼音與注音模式

# ========================================
# 簡繁轉換設定
# ========================================
simplifier:
  tips: all                          # 簡化字模式下提示對應的傳統漢字

# ========================================
# 拼寫設定
# ========================================
speller:
  alphabet: "abcdefghijklmnopqrstuvwxyz[];',."  # 可接受的字母範圍
  delimiter: "`"                                 # 分隔符號
  algebra:                                       # 拼寫代數規則
    - xform/^~(.*)$/$1                          # 去除「~」前綴
# 註：為了加強造詞準確性，在字典中以「~」前綴標記非標準拆字，
#     再透過拼寫語法去除「~」後，送入辭典查詢

# ========================================
# 主翻譯器設定（嘸蝦米）
# ========================================
translator:
  dictionary: liur.extended              # 使用的詞庫檔案
  db_class: tabledb                      # 資料庫類型（表格式）
  enable_user_dict: false                # 停用使用者詞典
  enable_sentence: false                 # 停用自動造句
  enable_encoder: false                  # 停用編碼器
  enable_charset_filter: true            # 啟用字集過濾
  encode_commit_history: false           # 不編碼上屏歷史
  max_phrase_length: 10                  # 最大詞組長度
  enable_completion: true                # 啟用自動補全
  comment_format:                        # 提示碼格式化
    - xform/^~(.+)$/>[$1]                # 將提示碼改為較美觀的型式
  disable_user_dict_for_patterns:        # 停用使用者詞典的輸入模式
    - "^[',.].*$"                        # 以標點開頭的輸入
  initial_quality: 1000                  # 初始候選字優先度（最高）

# ========================================
# 固定詞庫翻譯器設定
# ========================================
# 繼承主翻譯器設定，但啟用使用者詞典與編碼器
fixed:
  __include: /translator               # 繼承主翻譯器設定
  enable_encoder: true                 # 啟用編碼器（記憶使用者輸入）
  enable_user_dict: true               # 啟用使用者詞典
  initial_quality: 100                 # 優先度設為 100

# ========================================
# 造詞翻譯器設定
# ========================================
# 引導鍵：分號（;）
mkst:
  __include: /translator               # 繼承主翻譯器設定
  enable_sentence: true                # 啟用自動造句
  prefix: ';'                          # 引導鍵
  tips: "〔造詞〕"                      # 輸入時顯示的提示
  tag: mkst                            # 標籤名稱
  initial_quality: 10                  # 優先度設為 10（較低）

# ========================================
# 讀音反查翻譯器設定
# ========================================
# 引導鍵：兩個分號（;;）
liurqry:
  __include: /translator               # 繼承主翻譯器設定
  prefix: ";;"                         # 引導鍵（兩個分號）
  suffix: "'"                          # 結束鍵（單引號）
  tips: 【反查讀音】                    # 輸入時顯示的提示
  closing_tips: 【蝦米】                # 結束時顯示的提示
  initial_quality: 300                 # 優先度設為 300
  tag: liurqry                         # 標籤名稱

# ========================================
# 拼音翻譯器設定
# ========================================
# 引導鍵：反引號（`）
pinyin:
  tag: pinyin                          # 標籤名稱
  dictionary: luna_pinyin              # 使用朙月拼音詞庫
  prefix: "`"                          # 引導鍵（反引號）
  suffix: "'"                          # 結束鍵（單引號）
  preedit_format: &pinyin              # 預編輯格式（顯示 ü 等符號）
    - xform/([nl])v/$1ü/               # nv, lv → nü, lü
    - xform/([nl])ue/$1üe/             # nue, lue → nüe, lüe
    - xform/([jqxy])v/$1u/             # jv, qv, xv, yv → ju, qu, xu, yu
  tips: 【拼音】                        # 輸入時顯示的提示
  closing_tips: 【蝦米】                # 結束時顯示的提示
  initial_quality: 0.2                 # 優先度設為 0.2（較低）

# ========================================
# 注音翻譯器設定
# ========================================
# 引導鍵：單引號+分號（';）
phonetic:
  tag: phonetic                        # 標籤名稱
  prefix: "';"                         # 引導鍵（單引號+分號）
  suffix: "'"                          # 結束鍵（單引號）
  dictionary: terra_pinyin             # 使用地球拼音詞庫
  prism: bopomofo_tw                   # 使用注音（臺灣）編碼方案
  preedit_format:                      # 預編輯格式（鍵盤字母 → 注音符號）
    - "xlit|1qaz2wsxedcrfv5tgbyhnujm8ik,9ol.0p;/- 6347'|ㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄧㄨㄩㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦˉˊˇˋ˙ |"
  comment_format:                      # 候選字註解格式（顯示嘸蝦米字碼）
    - "xlit|abcdefghijklmnopqrstuvwxyz[];',.|abcdefghijklmnopqrstuvwxyz[];',.|"
  tips: 【注音】                        # 輸入時顯示的提示
  closing_tips: 【蝦米】                # 結束時顯示的提示
  initial_quality: 1.1                 # 優先度設為 1.1

# ========================================
# 注音反查過濾器設定
# ========================================
# 用於讀音反查（;;）時顯示注音
phonetic_reverse_lookup:
  tags: [ liurqry ]                    # 套用於讀音反查模式
  dictionary: terra_pinyin             # 使用地球拼音詞庫
  overwrite_comment: true              # 覆蓋其他提示
  comment_format:                      # 註解格式（拼音 → 注音）
    # 以下規則將拼音轉換為注音符號
    - "xform/e?r5$/er5/"               # 處理兒化音
    - "xform/iu/iou/"
    - "xform/ui/uei/"
    - "xform/ong/ung/"
    - "xform/yi?/i/"
    - "xform/wu?/u/"
    - "xform/iu/v/"
    - "xform/([jqx])u/$1v/"
    - "xform/([iuv])n/$1en/"
    - "xform/zh/Z/"                    # 暫存聲母
    - "xform/ch/C/"
    - "xform/sh/S/"
    - "xform/ai/A/"                    # 暫存韻母
    - "xform/ei/I/"
    - "xform/ao/O/"
    - "xform/ou/U/"
    - "xform/ang/K/"
    - "xform/eng/G/"
    - "xform/an/M/"
    - "xform/en/N/"
    - "xform/er/R/"
    - "xform/eh/E/"
    - "xform/([iv])e/$1E/"
    - "xform/1//"                      # 移除一聲標記
    - "xlit|bpmfdtnlgkhjqxZCSrzcsiuvaoeEAIOUMNKGR2345|ㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄧㄨㄩㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦˊˇˋ˙|"
    - xform/ /} {/                     # 音節間加分隔符號
    - xform/^/ {
    - xform/$/}/

# ========================================
# 標點符號處理器設定
# ========================================
punctuator:
#  import_preset: default            # 匯入預設標點設定（已停用）
#  import_preset: alternative        # 匯入替代標點設定（已停用）

# ========================================
# 按鍵綁定設定
# ========================================
key_binder:
  import_preset: default               # 匯入預設按鍵綁定

# ========================================
# 辨識器設定
# ========================================
# 用於辨識特殊輸入模式（電子郵件、網址、反查等）
recognizer:
  import_preset: default               # 匯入預設辨識器設定

  patterns:                            # 自訂辨識模式
    email: ^[a-z][-_.0-9a-z]*@.*$      # 電子郵件格式
    url: ^(www[.]|https?:|ftp:|mailto:).*$  # 網址格式
    phonetic: "';[1qaz2wsxedcrfv5tgbyhnujm8ik,9ol.0p;/6347-]*'?$"  # 注音反查：引導鍵 ';（「-」為「ㄦ」）
    pinyin: "`[a-z']*'?$"              # 拼音輸入：引導鍵 `
    mkst: "^;[a-z,.'`]*$"              # 造詞模式：引導鍵 ;
    liurqry: ";;[a-z']*'?$"            # 讀音反查：引導鍵 ;;